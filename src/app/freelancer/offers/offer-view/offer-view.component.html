<div class="min-vh-100 bg-light">
  <!-- Loading State -->
  <div
    *ngIf="isLoading"
    class="min-vh-100 bg-light d-flex align-items-center justify-content-center"
  >
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Carregando...</span>
    </div>
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading" class="container py-4">
    <!-- Proposal Not Found -->
    <div *ngIf="!proposal" class="row justify-content-center">
      <div class="col-md-8">
        <div class="card text-center py-5 shadow-sm">
          <div class="card-body">
            <h5 class="card-title text-dark mb-2">Proposta não encontrada</h5>
            <p class="card-text text-muted mb-4">
              A proposta que você está procurando não existe.
            </p>
            <button class="btn btn-primary" (click)="goBack()">
              Voltar às Propostas
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Proposal Content -->
    <div *ngIf="proposal">
      <!-- Back Button -->
      <button
        class="btn btn-link text-decoration-none mb-4 p-0"
        (click)="goBack()"
      >
        <i class="bi bi-arrow-left me-2"></i>
        Voltar às Propostas
      </button>

      <div class="row g-4">
        <!-- Main Content -->
        <div class="col-lg-8">
          <!-- Proposal Header -->
          <div class="card shadow-sm mb-4">
            <div class="card-header bg-white">
              <div class="d-flex justify-content-between align-items-start">
                <div class="flex-grow-1">
                  <h2 class="card-title mb-3">{{ proposal.title }}</h2>
                  <div class="d-flex flex-wrap gap-3 text-muted small">
                    <div class="d-flex align-items-center">
                      <i class="bi bi-calendar me-1"></i>
                      <span>Prazo: {{ formatDate(proposal.maxDate) }}</span>
                    </div>
                    <div class="d-flex align-items-center">
                      <i class="bi bi-clock me-1"></i>
                      <span
                        >Publicado em
                        {{ formatDate(proposal.createdDate) }}</span
                      >
                    </div>
                  </div>
                </div>
                <span
                  class="badge"
                  [ngClass]="
                    proposal.isAvailable === true
                      ? 'bg-success'
                      : 'bg-secondary'
                  "
                >
                  {{ proposal.isAvailable === true ? "Aberta" : "Fechada" }}
                </span>
              </div>
            </div>

            <div class="card-body">
              <!-- Description -->
              <div class="mb-4">
                <h5 class="text-dark mb-3">Descrição do Projeto</h5>
                <p class="text-muted lh-lg">{{ proposal.description }}</p>
              </div>

              <!-- Required Skills -->
              <div class="mb-4">
                <h5 class="text-dark mb-3">Habilidades Necessárias</h5>
                <div class="d-flex flex-wrap gap-2">
                  <span
                    *ngFor="let skill of proposal.requiredSkills"
                    class="badge bg-light text-dark border"
                  >
                    {{ skill.skill.name }}
                  </span>
                </div>
              </div>

              <!-- Budget -->
              <div class="card budget-card shadow-sm mb-4">
                <div class="card-body d-flex align-items-center gap-3">
                  <div class="icon-wrapper bg-opacity-10 text-success me-4">
                    <i class="bi bi-currency-dollar fs-3"></i>
                  </div>
                  <div>
                    <h6 class="card-subtitle mb-1 text-muted fw-medium">
                      Orçamento do Projeto
                    </h6>
                    <h2 class="card-title mb-0 fw-bold">
                      {{ formatCurrency(proposal.price) }}
                    </h2>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Application Form -->
          <div
            *ngIf="
              proposal.isAvailable &&
              !hasApplied &&
              !hasAppliedToProposal(proposal)
            "
            class="card shadow-sm mb-4"
          >
            <div class="card-header bg-white">
              <h5 class="card-title mb-1">Candidatar-se a esta Proposta</h5>
              <p class="text-muted small mb-0">
                Envie sua proposta e mostre por que você é o profissional ideal
                para este projeto.
              </p>
            </div>
            <div class="card-body">
              <form
                [formGroup]="applicationForm"
                (ngSubmit)="onSubmitApplication()"
              >
                <!-- Message -->
                <div class="mb-3">
                  <label for="message" class="form-label"
                    >Mensagem de Apresentação</label
                  >
                  <textarea
                    class="form-control"
                    [class.is-invalid]="isFieldInvalid('message')"
                    id="message"
                    rows="4"
                    placeholder="Conte sobre sua experiência e como você pode ajudar com este projeto..."
                    formControlName="message"
                  ></textarea>
                  <div
                    *ngIf="isFieldInvalid('message')"
                    class="invalid-feedback"
                  >
                    {{ getFieldError("message") }}
                  </div>
                </div>

                <div class="row g-3 mb-3">
                  <div class="col-md-6">
                    <label for="proposedRate" class="form-label"
                      >Sua Taxa Proposta (R$)</label
                    >
                    <input
                      type="number"
                      class="form-control"
                      [class.is-invalid]="isFieldInvalid('proposedRate')"
                      id="proposedRate"
                      placeholder="5000"
                      formControlName="proposedRate"
                    />
                    <div
                      *ngIf="isFieldInvalid('proposedRate')"
                      class="invalid-feedback"
                    >
                      {{ getFieldError("proposedRate") }}
                    </div>
                  </div>

                  <div class="col-md-6">
                    <label for="estimatedDuration" class="form-label"
                      >Prazo Estimado</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      [class.is-invalid]="isFieldInvalid('estimatedDuration')"
                      id="estimatedDuration"
                      placeholder="ex: 2 semanas"
                      formControlName="estimatedDuration"
                    />
                    <div
                      *ngIf="isFieldInvalid('estimatedDuration')"
                      class="invalid-feedback"
                    >
                      {{ getFieldError("estimatedDuration") }}
                    </div>
                  </div>
                </div>

                <button
                  type="submit"
                  class="btn btn-primary w-100"
                  [disabled]="isSubmitting"
                  (click)="onSubmitApplication()"
                >
                  <span
                    *ngIf="isSubmitting"
                    class="spinner-border spinner-border-sm me-2"
                    role="status"
                  ></span>
                  {{ isSubmitting ? "Enviando..." : "Enviar Candidatura" }}
                  <i *ngIf="!isSubmitting" class="bi bi-send ms-2"></i>
                </button>
              </form>
            </div>
          </div>

          <!-- Success Message -->
          <div
            *ngIf="hasApplied || hasAppliedToProposal(proposal)"
            class="card border-success bg-opacity-10 shadow-sm"
          >
            <div class="card-body text-center py-4">
              <div
                class="bg-opacity-25 rounded-circle d-inline-flex align-items-center justify-content-center mb-3"
                style="width: 48px; height: 48px"
              >
                <i class="bi bi-send text-success fs-5"></i>
              </div>
              <h5 class="text-success mb-2">Candidatura Enviada!</h5>
              <p class="text-success mb-0">
                Sua candidatura foi enviada com sucesso. A empresa será
                notificada e entrará em contato se houver interesse.
              </p>
            </div>
          </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
          <!-- Company Info -->
          <div *ngIf="company" class="card shadow-sm mb-4">
            <div class="card-header bg-white">
              <h6 class="card-title mb-0">
                <i class="bi bi-building me-2"></i>
                Sobre a Empresa
              </h6>
            </div>
            <div class="card-body">
              <!-- Company Header -->
              <div class="d-flex align-items-center mb-3">
                <div
                  class="bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center me-3"
                  style="width: 48px; height: 48px"
                >
                  <span class="text-user fw-bold">{{
                    getCompanyInitials(company.companyName)
                  }}</span>
                </div>
                <div>
                  <h6 class="mb-1">{{ company.companyName }}</h6>
                  <small class="text-muted">{{ company.industry }}</small>
                </div>
              </div>

              <!-- Company Description -->
              <p class="text-muted small mb-3">{{ company.description }}</p>

              <!-- Rating and Projects -->
              <div
                class="d-flex align-items-center justify-content-between mb-3"
              >
                <div class="d-flex align-items-center small">
                  <i class="bi bi-star-fill text-warning me-1"></i>
                  <span
                    >{{ company.rating }} ({{
                      company.totalProjects
                    }}
                    projetos)</span
                  >
                </div>
              </div>

              <!-- Contact Info -->
              <div class="small text-muted">
                <p class="mb-1">
                  <strong>Contato:</strong> {{ company.contactPerson }}
                </p>
                <p *ngIf="company.website" class="mb-0">
                  <strong>Website:</strong>
                  <a
                    [href]="company.website"
                    target="_blank"
                    class="text-primary text-decoration-none ms-1"
                  >
                    {{ company.website }}
                  </a>
                </p>
              </div>
            </div>
          </div>

          <!-- Project Stats -->
          <div class="card shadow-sm">
            <div class="card-header bg-white">
              <h6 class="card-title mb-0">Estatísticas do Projeto</h6>
            </div>
            <div class="card-body">
              <div
                class="d-flex justify-content-between align-items-center mb-2"
              >
                <span class="text-muted small">Candidaturas:</span>
                <span class="fw-semibold">{{
                  proposal.applications?.length
                }}</span>
              </div>
              <div
                class="d-flex justify-content-between align-items-center mb-2"
              >
                <span class="text-muted small">Orçamento:</span>
                <span class="fw-semibold text-success">
                  {{ formatCurrency(proposal.price) }}</span
                >
              </div>

              <div
                class="d-flex justify-content-between align-items-center mb-2"
              >
                <span class="text-muted small">Prazo:</span>
                <span class="fw-semibold">{{
                  formatDate(proposal.maxDate)
                }}</span>
              </div>
              <div class="d-flex justify-content-between align-items-center">
                <span class="text-muted small">Status:</span>
                <span
                  class="badge"
                  [ngClass]="
                    proposal.isAvailable === true
                      ? 'bg-success'
                      : 'bg-secondary'
                  "
                >
                  {{ proposal.isAvailable === true ? "Aberta" : "Fechada" }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
